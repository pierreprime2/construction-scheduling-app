# COG-002: SQLite Web GUI

**Status:** Implemented
**Created:** 2026-01-20 17:00
**Last Updated:** 2026-01-20 17:00
**Author:** Pierre

## Context

Pour le développement et le debugging, il est utile d'avoir une interface web pour visualiser et interroger la base de données SQLite. Cela permet d'inspecter les données sans avoir à se connecter en SSH ou utiliser des outils CLI.

## Requirements

- [x] Interface web accessible via le navigateur
- [x] Protection par mot de passe (pas d'accès public)
- [x] Fonctionne en local (dev) et en production
- [x] Accès en lecture seule à la base de données
- [x] Intégré à l'infrastructure Docker existante

## Technical Approach

### Solution choisie : sqlite-web

Après avoir évalué plusieurs options :
- **Adminer** : Problèmes de login avec SQLite (comportement incohérent)
- **phpLiteAdmin** : Image Docker non fonctionnelle
- **sqlite-web** : Léger, simple, supporte le URL prefix

### Architecture

```
Browser → nginx (/db/) → [basic auth] → sqlite-web:8080
                                              ↓
                                        api_data volume (read-only)
```

### Configuration

| Composant | Local (dev) | Production |
|-----------|-------------|------------|
| URL | http://localhost/db/ | https://domain/db/ |
| Auth | nginx basic auth | nginx basic auth |
| Service | profile `dev` (optionnel) | toujours actif |
| DB access | read-only | read-only |

## Implementation Notes

### Fichiers modifiés

| Fichier | Changement |
|---------|------------|
| `docker-compose.yml` | Service sqliteweb avec profile `dev` |
| `docker-compose.prod.yml` | Service sqliteweb (sans profile) |
| `nginx.ci.conf` | Route `/db/` avec basic auth |
| `nginx.conf` | Route `/db/` avec basic auth |
| `.gitignore` | Ajout `htpasswd` |
| `scripts/vps-init.sh` | Instructions pour créer htpasswd |

### Configuration sqlite-web

```yaml
sqliteweb:
  image: coleifer/sqlite-web
  expose:
    - "8080"
  volumes:
    - api_data:/data:ro
  command: sqlite_web -H 0.0.0.0 -p 8080 -u /db /data/data.db
```

Le flag `-u /db` configure le URL prefix pour que les assets statiques soient servis correctement quand l'app est montée sous `/db/`.

### Configuration nginx

```nginx
location = /db {
    return 301 /db/;
}
location /db/ {
    auth_basic "Database Admin";
    auth_basic_user_file /etc/nginx/.htpasswd;
    proxy_pass http://sqliteweb:8080;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

### Credentials

- **Local** : `htpasswd` file avec `admin:admin` (gitignored)
- **Production** : Créer avec `htpasswd -c ~/cogit/htpasswd admin` (mot de passe fort)

## Validation Criteria

- [x] sqlite-web accessible sur http://localhost/db/
- [x] Basic auth bloque l'accès sans credentials
- [x] CSS et assets statiques chargent correctement
- [x] Tables et données visibles dans l'interface
- [x] Configuration production prête (htpasswd à créer sur VPS)

## Changes Log

- 2026-01-20 17:00: Création initiale - sqlite-web avec nginx basic auth
